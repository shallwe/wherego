// Generated by CoffeeScript 1.8.0
(function() {
  var main, setRandomCity, toggleRandom;

  setRandomCity = (function(_this) {
    return function() {
      var city, data, names;
      names = _.keys(_this.cities);
      city = names[_.random(0, names.length - 1)];
      data = [
        {
          name: city,
          value: _this.cities[city].concat(city)
        }
      ];
      return _this.mapChart.setOption({
        series: {
          data: data
        }
      });
    };
  })(this);

  toggleRandom = (function(_this) {
    return function() {
      if (_this.interval) {
        clearInterval(_this.interval);
        return _this.interval = null;
      } else {
        return _this.interval = setInterval(setRandomCity, 500);
      }
    };
  })(this);

  main = (function(_this) {
    return function() {
      _this.mapChart = echarts.init($("#chart")[0]);
      mapChart.setOption({
        title: {
          text: '我们去哪玩儿(点击地图开始选择)',
          textStyle: {
            color: '#fff'
          }
        },
        backgroundColor: '#404a59',
        tooltip: {
          show: true,
          showContent: true,
          trigger: 'item',
          position: 'top',
          formatter: '{a} {b} {c}',
          backgroundColor: 'black',
          textStyle: {
            color: '#1a2'
          }
        },
        geo: {
          map: 'china',
          label: {
            emphasis: {
              show: false
            },
            itemStyle: {
              normal: {
                areaColor: '#0f0',
                borderColor: '#111'
              }
            }
          }
        },
        series: [
          {
            name: '踪迹',
            type: 'scatter',
            coordinateSystem: 'geo',
            symbolSize: 10,
            label: {
              normal: {
                show: true,
                formatter: '{b}',
                textStyle: {
                  color: 'black'
                },
                position: 'top'
              },
              emphasis: {
                show: false
              }
            },
            itemStyle: {
              emphasis: {
                borderColor: '#fff',
                borderWidth: 1
              }
            },
            data: []
          }
        ]
      });
      return $.getJSON("/static/china.json", function(resp) {
        _this.provinces = resp;
        _this.cities = {};
        _.map(provinces, function(p, cs) {
          return _.merge(_this.cities, p);
        });
        return _this.mapChart.on('click', toggleRandom);
      });
    };
  })(this);

  $(main);

}).call(this);
